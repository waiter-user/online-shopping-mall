<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <title>购物车</title>


    <link th:href="@{/css/layout.css}"
          type="text/css" rel="stylesheet" />

    <script language="JavaScript"
            th:src="@{/js/public.js}"
            type="text/javascript">

    </script>

    <style rel="stylesheet" type="text/css" media="screen">
    </style>
</head>
<body>
<!-- 包含头部页面 -->
<div th:replace="inc/top::#common-top"></div>

<div class="page_row">
    <!--左边的 -->
    <div class="page_main_msg left">
        <div class="left_row">
            <div class="list pic_news">
                <div class="list_bar">&nbsp;我的购物车</div>
                <!-- 判断session中是否有购物车数据，如果没有，显示“您的购物车空空如也”，否则就显示购物车的数据到表格中 -->
<!--                    cart.items=cart.getItems()-->
                <div th:unless="${session.cart.items.size()>0} or session.cart!=null">
                        <h2 >您的购物车空空如也</h2>
                        <!-- 显示继续购物的图片 -->
                        <a th:href="@{/goods(action=queryByPage)}"><img
                                border="0"
                                src="images/Car_icon_02.gif" /></a>
                </div>
                <div th:if="${session.cart.items.size()>0} or session.cart!=null">
                        <table width="99%" border="0" cellpadding="2" cellspacing="1"
                               bgcolor="#FFFFFF" align="center" style="margin-top:8px">
                            <tr align="center" bgcolor="#FAFAF1" height="22">
                                <td>商品名称</td>
                                <td>价格</td>
                                <td>数量</td>
                                <td>金额</td>
                                <td>删除</td>
                            </tr>
                                <tr align='center' bgcolor="#FFFFFF" height="22" th:each="items:${session.cart.items}">
                                    <td th:text="${items.goods.goods_name}"></td>
                                    <td th:text="${items.goods.mall_price}"><br /></td>
                                    <td><input type="text" class="textBox"
                                               th:onchange="|modifyNum(${items.goods.goods_id},this.value)|"
                                               th:value="${items.quantity }" size="4" /></td>
                                    <td th:text="'￥'+${items.price}"></td>
                                    <td><input type="image"
                                               th:onclick="|deleteCartItem(${items.goods.goods_id})|"
                                               src="images/delete_01.gif"
                                               border="0" /></td>
                                </tr>
                            <tr>
                                <td colspan="5" class="Order_Total"><img hspace="5"
                                                                         src="images/me03.gif" />
                                    总金额：￥<span id="totalMoney" th:text="${session.cart.totalPrice}"></span>
                                <img id="indicator1" src="images/loading.gif" style="display:none"/>
                                </td>
                            </tr>
                        </table>

                        <table>
                            <tr height="7">
                                <td></td>
                            </tr>
                            <tr>
                                <td width="120"></td>
                                <td>
                                    <a href="javascript:void(0)"
                                       onclick="clearCart()"><img border="0"
                                                                  src="images/Car_icon_01.gif" /></a>
                                </td>
                                <td><a
                                        th:href="@{/goods(action=queryByPage)}"><img
                                        border="0"
                                        src="images/Car_icon_02.gif" /></a></td>
                                <td>
                                    <!-- 点击“下一步”，直接跳转到订单确认的页面 -->
                                    <a
                                            href="order?action=sure"><img
                                            border="0"
                                            src="images/Car_icon_03.gif" /></a></td>
                            </tr>
                        </table>
                </div>
            </div>
        </div>
    </div>
    <!--左边的 -->

    <!-- 右边的用户登录。-->
    <div class="page_other_msg right">
        <div th:replace="inc/userLogin::#common-login"></div>
    </div>
    <!-- 右边的用户登录。-->
    <div style="clear: both"></div>

</div>



<!-- 包含尾部页面 -->

<div th:replace="inc/foot::#F"></div>




<script language="javascript" type="text/javascript"
        src="qiantai/qimg/png.js">

</script>
<script>
    function deleteCartItem(id){
        let flag=confirm("确实删除购物项?");
        if(flag){
            location.href="cart?action=deleteItem&id="+id;
        }
    }
    function modifyNum(id,num){
        let regex=/^[1-9]\d*$/;
        // 格式/^表达式$/,[1-9]范围,\d[0-9],*可以有多个前面的限制:0-9
        if(!regex.test(num)){
            alert('请输入正整数');
            return;
        }
        location.href="cart?action=updateQuantity&id="+id+"&num="+num;
    }
    function clearCart(){
        let b = confirm("确认清空购物车吗?");
        if(b){
            location.href="cart?action=clearCart";
        }
    }
</script>
</body>
</html>